# Playing Card Recognizer

A real-time playing card recognition system using classical computer vision methods.

## Description

This application captures webcam frames or processes images from a folder, detects a single playing card, and identifies its rank and suit using classical computer vision techniques. The pipeline includes card detection via edge and contour analysis, perspective transformation, patch extraction, and ORB-based feature matching. CamShift tracking is included for improved runtime efficiency.

## Features

- Real-time webcam input or sequential processing of images
- Card detection using edge detection and contour analysis
- Perspective transform to standardize card images
- Patch extraction for rank and suit
- ORB keypoint matching for rank and suit recognition
- CamShift tracking for stability (optional)
- Logging of detection results to CSV file

## Installation

### Prerequisites
- Python 3.11+
- Conda (Miniconda recommended)

### Setup Environment

```bash
# Create and activate conda environment
conda create -n playing-card-recognizer python=3.11
conda activate playing-card-recognizer

# Install dependencies
conda install -c conda-forge opencv numpy pytest matplotlib
```

## Usage

All scripts are located in the `src/` folder.

### 1. Preprocess Templates
Generate and preprocess templates for rank and suit patches (must be done before recognition):
```bash
python src/preprocess_templates.py
```

### 2. Run the Recognizer (Main App)
Detect and recognize cards in real time from webcam or images:
```bash
python src/detect_card.py --webcam
# or for folder-based batch processing:
python src/detect_card.py --folder path/to/images
```

### 3. Visual Inspection & Testing (for Debugging Only)
These scripts are NOT part of the main app, but help you inspect and debug the patch extraction and recognition pipeline:

- `src/inspect_rank_patches.py` — Visually compare extracted rank or suit patches from full card images with their templates. Toggle `PATCH_TYPE` at the top to inspect either rank or suit. Use this to verify patch alignment and preprocessing visually.
- `src/test_accuracy_on_full.py` — Run batch accuracy tests on all full card images. Saves preprocessed patches to `debug_images/` for inspection and prints ORB keypoint counts for each patch.

### Notes
- Patch extraction and preprocessing logic is now **identical** across all scripts (main app, template preprocessing, and inspection/testing). This ensures consistency and reliable evaluation.
- Only scripts in `src/` are used by the main app. The inspection scripts are for development/testing only.

## Troubleshooting Low Accuracy
- If recognition accuracy is low:
  - Use `src/inspect_rank_patches.py` and check that extracted patches match their templates visually (alignment, contrast, size).
  - Check the debug images in `debug_images/` generated by `src/test_accuracy_on_full.py`.
  - Ensure ORB keypoints (`rank_kp`, `suit_kp`) are nonzero; if zero, try adjusting threshold values or template quality.
  - Make sure all patch sizes and preprocessing steps are consistent across the codebase.
  - Re-generate templates if you update the extraction logic.

## Project Structure

```
playing-card-recognizer/
├── src/                 # Source code
├── templates/           # Reference card templates
├── tests/               # Unit and integration tests
├── results/             # Logs and performance metrics
└── README.md            # Project documentation
```

## License

[MIT](LICENSE)
